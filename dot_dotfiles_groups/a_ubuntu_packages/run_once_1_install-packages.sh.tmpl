#!/bin/bash
set -e

{{ if and (eq .chezmoi.os "linux") (eq (get .chezmoi.osRelease "idLike") "debian") | not -}}
exit 0
{{ end }}
{{- if eq (env "CODESPACES") "true" }}
exit 0
{{ end }}

# hash: {{ include "dot_dotfiles_groups/a_ubuntu_packages/packages.txt" | sha256sum }}

sudo apt update

# Install package
{{ range include "dot_dotfiles_groups/a_ubuntu_packages/packages.txt" | splitList "\n" }}
{{ if . }}
{{ if contains "#" . | not }}
    echo "Package: {{.}}"
    package_installed=$(dpkg-query -W -f='${Status}' {{.}} 2>/dev/null | grep -c "ok installed")
    if [ $package_installed -eq 0 ]; then
        echo "Package {{.}} not installed, installing"
        sudo apt install -y {{.}}
    else
        echo "Package {{.}} already installed, skipping"
    fi
{{ end }}
{{ end }}
{{ end }}
